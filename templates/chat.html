{% extends 'base.html' %}

{% block content %}
{% load static %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<div class="row m-5">
  <div class="col-12 mt-4 p-5" style="background-color: #2a3042; font-family: 'Roboto', sans-serif;">
    <h1 class="fs-2" style="color: #a6b0cf;"><i class="fa-solid fa-comments"></i> chat </h1>
    <form id="post-form">
      {% csrf_token %}
      <textarea id="textarea" name="textarea" class="col-12 p-3 fs-4 mt-3"
        style="color: #a6b0cf; background-color: #32394e; border: #222736 solid 1px;"
        placeholder="Fikir bildirish"></textarea>
      <input class="btn btn-primary p-2 fs-5 mt-3 ps-4 pe-4" type="submit" value="Yuborish">
    </form>

    <div class="m-5"></div>
  </div>
</div>


<div id="display">

  <!-- <div class="container darker">
    <b>Tom</b><p>Hello Everyone, How Are You Guys Doing?</p>
    <span class="time-left">20th, April 2021</span>
  </div> -->

</div>
<script>
  $(document).ready(function () {
    setInterval(function () {
      $.ajax({
        type: 'GET',
        url: "/chat/getmessage",
        success: function (response) {
          console.log(response);
          $("#display").empty();
          for (var key in response.messages) {
            var temp = "<div class='container darker infinite-item'><b>" + response.messages[key].message + "</b><p>" + response.messages[key].author + "</p><span class='time-left'>" + response.messages[key].date + "</span></div>";
            $("#display").append(temp);
          }
        },
        error: function (response) {
          alert('An error occured')
        }
      });
    }, 1000);
  })
</script>

<script type="text/javascript">
  $(document).on('submit', '#post-form', function (e) {
    e.preventDefault();
    $.ajax({
      type: 'POST',
      url: '/chat/send',
      data: {
        textarea: $('#textarea').val(),
        csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
      },
      success: function (data) {
        //alert(data)
      }
    });
    document.getElementById('textarea').value = ''
  });
</script>
{% endblock content %}